<html>
<head>
  <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase-messaging.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.6.9/firebase.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.3/css/bootstrap.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="main.css" />
</head>
<body>
  <header>
    <h1><img src="http://wuct.wustl.edu/images/wuct.jpg" alt="WUCT" />Broken Bonds Round: Control Panel</h1>
  </header>
  
  <input type="text" placeholder="id" id="newid" />
  <input type="text" placeholder="new name" id="newname" />
  <input type="submit" value="Set team name" onclick="addTeam();" />
  <input type="submit" value="Remove team with this ID" onclick="deleteTeam();" />
  
  <div id="app"></div>
  
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyC4siYV0A1Nq4POMUfvdRKyP0-xzUUvMVo",
      authDomain: "wuct-1f4ca.firebaseapp.com",
      databaseURL: "https://wuct-1f4ca.firebaseio.com",
      storageBucket: "wuct-1f4ca.appspot.com",
      messagingSenderId: "833633709327"
    };
    firebase.initializeApp(config);
    var fb = firebase.database().ref('wuct2017');
    
    window.teamNames = {};
    window.scores = [];
    
    function addTeam(){
        fb.child('teams').child(document.getElementById('newid').value).set({name:document.getElementById('newname').value});
        document.getElementById('newid').value = '';
        document.getElementById('newname').value = '';
        return false;
    }
    function deleteTeam(){
      fb.child('teams').child(document.getElementById('newid').value).remove();
      fb.child('scores').child('team'+document.getElementById('newid').value).remove();
      console.log('team'+document.getElementById('newid').value);
      document.getElementById('newid').value = '';
        document.getElementById('newname').value = '';
        return false;
    }
    
    fb.child('teams').on('value', function(snapshot){
      window.teamNames = {};
      teamNames = snapshot.val();
      render();
    });
    
    function render(){
      var s = "";
      for(var id in teamNames)
        if(teamNames.hasOwnProperty(id) && window.teamNames[id].name)
          s +="<div>"+ id + ": "+ window.teamNames[id].name +"</div>";
      document.getElementById('app').innerHTML = s;
    }
  </script>
</body>
</html>
